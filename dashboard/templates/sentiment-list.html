{% extends 'layouts/new-base.html' %} {% block title%}
<title>Repustate Insights | {{project_name}}</title>
{% endblock%} {% block content %}
<div class="main-content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="porject-title align-items-center d-flex flex-wrap">
                    <a href="#" class="all-data">Sentiment List</a>
                    <div class="ml-auto">
                        <form>
                            <div class="form-row align-items-center">
                                <div class="col-auto">
                                    <a
                                        href="#modal"
                                        id="create-sentiment-button"
                                        class="btn btn-outline-primary btn-outline-1"
                                        data-toggle="modal"
                                        data-target="create-sentiment-button"
                                        > Add New Sentiment Rule</a
                                    >
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12 prject-card">
                <div class="prject-card-inner">
                    <div class="data-table table-responsive">
                        <table class="table table-striped table-borderless">
                            <thead>
                                <tr>
                                    <th scope="col">
                                        Name
                                        <span class="data-short">
                                            <a href="#" class="active">
                                                <i class="fe fe-chevron-up"></i>
                                            </a>
                                            <a href="#">
                                                <i
                                                    class="fe fe-chevron-down"
                                                ></i>
                                            </a>
                                        </span>
                                    </th>
                                    <th scope="col">
                                        Sentiment Text
                                        <span class="data-short">
                                            <a href="#" class="active">
                                                <i class="fe fe-chevron-up"></i>
                                            </a>
                                            <a href="#">
                                                <i
                                                    class="fe fe-chevron-down"
                                                ></i>
                                            </a>
                                        </span>
                                    </th>
                                    <th scope="col">
                                        Language
                                        <span class="data-short">
                                            <a href="#" class="active">
                                                <i class="fe fe-chevron-up"></i>
                                            </a>
                                            <a href="#">
                                                <i
                                                    class="fe fe-chevron-down"
                                                ></i>
                                            </a>
                                        </span>
                                    </th>
                                    <th scope="col">
                                        Sentiment
                                        <span class="data-short">
                                            <a href="#" class="active">
                                                <i class="fe fe-chevron-up"></i>
                                            </a>
                                            <a href="#">
                                                <i
                                                    class="fe fe-chevron-down"
                                                ></i>
                                            </a>
                                        </span>
                                    </th>
                                    <th scope="col">
                                        Action
                                        <span class="data-short">
                                            <a href="#">
                                                <i class="fe fe-chevron-up"></i>
                                            </a>
                                            <a href="#">
                                                <i
                                                    class="fe fe-chevron-down"
                                                ></i>
                                            </a>
                                        </span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for sentiment in sentiments %}
                                <tr>
                                    <td>{{sentiment.label}}</td>

                                    <td>
                                        {{sentiment.text}}
                                    </td>

                                    <td class="text-center">
                                        {{sentiment.language}}
                                    </td>
                                    <td class="text-center">
                                        {{sentiment.sentiment}}
                                    </td>
                                    <td class="text-center">
                                        <!--
                      <a href="#" class="icon-link" data-toggle="modal" data-target="#testaspect" >
                        <i class="fe fe-eye" data-toggle="tooltip" data-placement="bottom" title="Test Aspect"></i>
                      </a>
-->
                                        <a
                                            href="#"
                                            class="icon-link"
                                            data-toggle="tooltip"
                                            data-role="edit-sentiment-button"
                                            data-placement="bottom"
                                            title="Edit Sentiment"
                                            data-sentiment-text="{{sentiment.text}}"
                                            data-sentiment-label="{{sentiment.label}}"
                                            data-sentiment-sentiment="{{sentiment.sentiment}}"
                                            data-sentiment-language="{{sentiment.language}}"
                                            data-sentiment-id="{{sentiment.id}}"
                                        >
                                            <i class="fe fe-edit"></i>
                                        </a>

                                        <a
                                            href="#"
                                            class="icon-link trash"
                                            data-toggle="tooltip"
                                            data-role="delete-sentiment"
                                            data-placement="bottom"
                                            data-sentiment-id="{{sentiment.id}}"
                                            title="Delete Sentiment"
                                        >
                                            <i class="fe fe-trash-2"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div class="table-bottom">
                        <div class="row no-gutters">
                            <div class="col-12 col-md">
                                <div class="pagination-data">
                                    Showing {{meta.page_items_from}} to
                                    {{meta.page_items_to}} of {{sentiments |length}} entries
                                </div>
                            </div>

                            <div class="col-12 col-md-auto">
                                <ul class="pagination">
                                {% if page.has_previous == True %}
                                    <li>
                                        <a href="{% url 'aspects' %}?page={{page.previous_page_number}}">
                                            <i class="fe fe-chevron-left"></i>
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if page.has_previous == False %}
                                        <li class="active">
                                            <a href="{% url 'aspects' %}?page=1">1</a>
                                        </li>
                                        {% else %}
                                        <li>
                                            <a href="{% url 'aspects' %}?page=1">1</a>
                                        </li>
                                    {% endif %} 
                                    {%if paginator.num_pages != 1%} 
                                        {% if page.page_number > 2 %}
                                        <li>
                                            <a href="#">..</a>
                                        </li>
                                        <li class="active">
                                            <a href="{% url 'aspects' %}?page={{page.number}}">{{page.number}}</a>
                                        </li>
                                        {% else %}
                                            {%if page.number == 2 %}
                                            <li class="active">
                                            {%else%}
                                            <li >
                                            {%endif%}
                                            <a href="{% url 'aspects' %}?page=2" class="active">2</a>
                                        </li>
                                        {% endif %} 
                                    {% endif %}
                                    {% if page.has_next == True %}
                                    <li>
                                        <a href="{% url 'aspects' %}?page={{page.next_page_number}}">
                                            <i class="fe fe-chevron-right"></i>
                                        </a>
                                    </li>
                                    {%endif%}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--<a href="#" class="btn btn-primary mr-2" data-toggle="modal" data-target="#testaspect" >
        Test aspect modal
      </a>-->
        {% comment %}
        <a
            href="#"
            class="btn btn-primary mr-2"
            data-toggle="modal"
            data-target="#create-sentiment"
        >
            Create aspect modal
        </a>
        {% endcomment %}
        <a href="#" class="btn btn-primary mr-2" data-toggle="modal" id="show-test-sentiment-modal">
            Test sentiment
          </a>
    </div>

</div>
<div
    class="modal fade show"
    id="test-sentiment-modal"
    tabindex="-1"
    aria-label="createaspectLabel"
    style="z-index: 100;overflow-y:scroll;"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Test Sentiment</h5>
                <button
                    type="button"
                    class="close"
                    data-dismiss="modal"
                    aria-label="Close"
                >
                    <i
                        class="fe fe-x-circle"
                        onclick="closeTestSentimentModal()"
                    ></i>
                </button>
            </div>
            <div class="modal-body" style="overflow-y:visible;position:relative">
                <div class="modal-data">
                    <form method="POST" action="/sentiment/" id="test-sentiment-form">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="aspect-name" class="form-label">Text</label>
                            <input
                                name="test-sentiment-text"
                                type="text"
                                class="form-control"
                                placeholder="Text"
                            />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Language</label>
                            <select class="custom-select" name="text-language">
                                <option value="en">English</option>
                                <option value="ar">Arabic (العربية)</option>
                                <option value="zh">Chinese (中文)</option>
                                <option value="da">Danish (Dansk)</option>
                                <option value="nl">Dutch (Nederlands)</option>
                                <option value="en">English</option>
                                <option value="fi">Finnish (Suomi)</option>
                                <option value="fr">French (Français)</option>
                                <option value="de">German (Deutsch)</option>
                                <option value="he">Hebrew (עִברִית)</option>
                                <option value="it">Italian (Italiano)</option>
                                <option value="id">Indonesian (Bahasa Indonesia)</option>
                                <option value="ja">Japanese (日本語)</option>
                                <option value="ko">Korean (한국어)</option>
                                <option value="no">Norwegian (Norsk)</option>
                                <option value="pl">Polish (Polski)</option>
                                <option value="pt">Portuguese (Português)</option>
                                <option value="ru">Russian (русский)</option>
                                <option value="es">Spanish (Español)</option>
                                <option value="sv">Swedish (Svenska)</option>
                                <option value="tr">Turkish (Türk)</option>
                                <option value="th">Thai (ไทย)</option>
                                <option value="vi">Vietnamese (Tiếng Việt)</option>
                                <option value="ur">Urdu (اردو)</option>
                            </select>
                        </div>
                        <div id="test-sentiment-score">
                            Score
                        </div>
<!--                         <input type="hidden" name = "_method" value="PUT"></input> -->
                        <button type="submit" class="btn btn-primary mt-2">
                            Test Sentiment
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function closeTestSentimentModal(){
        document.querySelector("#test-sentiment-modal").style.display="none"
    }

    document.querySelector("#show-test-sentiment-modal").addEventListener("click", (e)=>{
        document.querySelector("#test-sentiment-modal").style.display="block"
    })
</script>
<div
    class="modal fade show"
    id="create-sentiment-modal"
    tabindex="-1"
    aria-label="createaspectLabel"
    style="z-index: 100;overflow-y:scroll;"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create Sentiment Rule</h5>
                <button
                    type="button"
                    class="close"
                    data-dismiss="modal"
                    aria-label="Close"
                >
                    <i
                        class="fe fe-x-circle"
                        onclick="closeCreateSentimentModal()"
                    ></i>
                </button>
            </div>
            <div class="modal-body" style="overflow-y:visible;position:relative">
                <div class="modal-data">
                    <form method="POST" action="/sentiment/" id="create-sentiment-form">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="aspect-name" class="form-label">Rule Name</label>
                            <input
                                name="sentiment-label"
                                type="text"
                                class="form-control"
                                placeholder="Enter Rule Name"
                            />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Text Definition (max 3 words)</label>
                            <input
                                name="sentiment-definition"
                                type="text"
                                class="form-control"
                                placeholder="Text Definition"
                            />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Sentiment</label>
                            <select class="custom-select" name="sentiment">
                                <option value="positive">Positive</option>
                                <option value="negative">Negative</option>
                                <option value="neutral">Neutral</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Language</label>
                            <select class="custom-select" id="selectaspect" name="sentiment-language">
                                <option value="en">English</option>
                                <option value="ar">Arabic (العربية)</option>
                                <option value="zh">Chinese (中文)</option>
                                <option value="da">Danish (Dansk)</option>
                                <option value="nl">Dutch (Nederlands)</option>
                                <option value="en">English</option>
                                <option value="fi">Finnish (Suomi)</option>
                                <option value="fr">French (Français)</option>
                                <option value="de">German (Deutsch)</option>
                                <option value="he">Hebrew (עִברִית)</option>
                                <option value="it">Italian (Italiano)</option>
                                <option value="id">Indonesian (Bahasa Indonesia)</option>
                                <option value="ja">Japanese (日本語)</option>
                                <option value="ko">Korean (한국어)</option>
                                <option value="no">Norwegian (Norsk)</option>
                                <option value="pl">Polish (Polski)</option>
                                <option value="pt">Portuguese (Português)</option>
                                <option value="ru">Russian (русский)</option>
                                <option value="es">Spanish (Español)</option>
                                <option value="sv">Swedish (Svenska)</option>
                                <option value="tr">Turkish (Türk)</option>
                                <option value="th">Thai (ไทย)</option>
                                <option value="vi">Vietnamese (Tiếng Việt)</option>
                                <option value="ur">Urdu (اردو)</option>
                            </select>
                        </div>
<!--                         <input type="hidden" name = "_method" value="PUT"></input> -->
                        <button type="submit" class="btn btn-primary mt-2">
                            Create Sentiment Rule
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div
    class="modal fade show"
    id="edit-sentiment-modal"
    tabindex="-1"
    aria-label="createaspectLabel"
    style="z-index: 100;overflow-y:scroll;"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Sentiment Rule</h5>
                <button
                    type="button"
                    class="close"
                    data-dismiss="modal"
                    aria-label="Close"
                >
                    <i
                        class="fe fe-x-circle"
                        onclick="closeEditSentimentModal()"
                    ></i>
                </button>
            </div>
            <div class="modal-body" style="overflow-y:visible;position:relative">
                <div class="modal-data">
                    <form method="POST" action="/sentiment/" id="edit-sentiment-form">
                        {% csrf_token %}
                        <input type="hidden" id="edit-sentiment-id"/>
                        <div class="form-group">
                            <label for="aspect-name" class="form-label">Sentiment Rule</label>
                            <input
                                name="sentiment-label"
                                type="text"
                                class="form-control"
                                id="edit-sentiment-label"
                                placeholder="Enter Rule Name"
                            />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Text Definition (max 3 words)</label>
                            <input
                                name="sentiment-definition"
                                type="text"
                                class="form-control"
                                id="edit-sentiment-text"
                                placeholder="Text Definition"
                            />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Sentiment</label>
                            <select class="custom-select" name="sentiment" id="edit-sentiment-value">
                                <option value="positive">Positive</option>
                                <option value="negative">Negative</option>
                                <option value="neutral">Neutral</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Language</label>
                            <select class="custom-select" id="edit-sentiment-language" name="sentiment-language">
                                <option value="en">English</option>
                                <option value="ar">Arabic (العربية)</option>
                                <option value="zh">Chinese (中文)</option>
                                <option value="da">Danish (Dansk)</option>
                                <option value="nl">Dutch (Nederlands)</option>
                                <option value="en">English</option>
                                <option value="fi">Finnish (Suomi)</option>
                                <option value="fr">French (Français)</option>
                                <option value="de">German (Deutsch)</option>
                                <option value="he">Hebrew (עִברִית)</option>
                                <option value="it">Italian (Italiano)</option>
                                <option value="id">Indonesian (Bahasa Indonesia)</option>
                                <option value="ja">Japanese (日本語)</option>
                                <option value="ko">Korean (한국어)</option>
                                <option value="no">Norwegian (Norsk)</option>
                                <option value="pl">Polish (Polski)</option>
                                <option value="pt">Portuguese (Português)</option>
                                <option value="ru">Russian (русский)</option>
                                <option value="es">Spanish (Español)</option>
                                <option value="sv">Swedish (Svenska)</option>
                                <option value="tr">Turkish (Türk)</option>
                                <option value="th">Thai (ไทย)</option>
                                <option value="vi">Vietnamese (Tiếng Việt)</option>
                                <option value="ur">Urdu (اردو)</option>
                            </select>
                        </div>
<!--                         <input type="hidden" name = "_method" value="PUT"></input> -->
                        <button type="submit" class="btn btn-primary mt-2">
                            Edit Sentiment
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
function closeCreateSentimentModal(){
    let modal = document.querySelector("#create-sentiment-modal")
    modal.style.display = "none"
}
function closeEditSentimentModal(){
    let modal = document.querySelector("#edit-sentiment-modal")
    modal.style.display = "none"
}
document.querySelector("#create-sentiment-button").addEventListener("click", (e)=>{
    let modal = document.querySelector("#create-sentiment-modal")
    modal.style.display = "block"
})

document.querySelectorAll("[data-role='delete-sentiment']").forEach((element) => {
    element.addEventListener("click", (e) => {
        sentimentID = e.currentTarget.getAttribute("data-sentiment-id")
        fetch("/sentiment/" + sentimentID + "/", {
            method:'delete'
        }).then((response) => {
            if(response.status == 200){
                location.reload()
            } else {
                alert("Error deleting sentiment")
            }
        })
    })
})
document.querySelectorAll("[data-role='edit-sentiment-button']").forEach((element) => {
    element.addEventListener("click", (e) => {
        document.querySelector("#edit-sentiment-modal").style.display = "block"
        let element = e.currentTarget
        sentimentID = element.getAttribute("data-sentiment-id")
        sentimentValue = element.getAttribute("data-sentiment-sentiment")
        sentimentLanguage = element.getAttribute("data-sentiment-language")
        sentimentText = element.getAttribute("data-sentiment-text")
        sentimentLabel = element.getAttribute("data-sentiment-label")
        document.querySelector("#edit-sentiment-label").value = sentimentLabel
        document.querySelector("#edit-sentiment-text").value = sentimentText
        document.querySelector("#edit-sentiment-value").value = sentimentValue
        document.querySelector("#edit-sentiment-language").value = sentimentLanguage
        document.querySelector("#edit-sentiment-id").value = sentimentID
/*         fetch("/sentiment/" + ruleID + "/", {
            method:'delete'
        }).then((response) => {
            if(response.status == 200){
                location.reload()
            } else {
                alert("Error deleting sentiment")
            }
        }) */
    })
})
document.querySelector("#create-sentiment-form").addEventListener("submit", (e)=>{
    e.preventDefault()
    let formData = new FormData(e.currentTarget)
    fetch("/sentiment/", {
        method: 'post',
        body: formData
    }).then(response => {
        if(response.status == 200){
            location.reload()
        } else if(response.status == 400){
            response.text().then(data =>{
                console.log("test")
                alert("Error creating sentiment: " + data)
            })
        } else {
            alert("Error creating sentiment")
        }
    })
})
document.querySelector("#test-sentiment-form").addEventListener("submit", (e)=>{
    e.preventDefault()
    let formData = new FormData(e.currentTarget)
    let scoreDiv = document.querySelector("#test-sentiment-score")
    scoreDiv.innerHTML = "Loading..."
    fetch("/api/test-sentiment/", {
        method: 'post',
        body: formData
    }).then(response => {
        if(response.status == 200){
            response.json().then(data=>{
                console.log(data)
                scoreDiv.innerHTML = "Score: " + data.score
            })
        } else {
            alert("Error testing sentiment")
        }
    })
})
document.querySelector("#edit-sentiment-form").addEventListener("submit", (e)=>{
    e.preventDefault()
    let formData = new FormData(e.currentTarget)
    let sentimentID = document.querySelector("#edit-sentiment-id").value
    fetch("/sentiment/" + sentimentID + "/", {
        method: 'post',
        body: formData
    }).then(response => {
        if(response.status == 200){
            location.reload()
        } else if(response.status == 400){
            response.text().then(data =>{
                console.log("test")
                alert("Error creating sentiment: " + data)
            })
        } else {
            alert("Error creating sentiment")
        }
    })
})
</script>
<!--<script src="/static/assets/js/bundle.js"></script>-->
{% endblock %}
